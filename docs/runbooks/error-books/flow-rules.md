# 错题本 — 通用/流程（每次必读）

### DEV-4 跳过流程门控直接编码 `🔴高频×9`

❌ 跳过需求评审直接写代码；AR 完成后跳过串讲+测试用例设计；拿到完整方案不提取待确认点直接派 agent 开干；测试绿了直接写总结跳过 Code Review；M6.1 里程碑跳过 IR 评审直接编码，写完代码测试全绿后才发现没做 Code Review；错题本落盘跳过第 2 步"Read 记录规则"直接写 → 格式违规；用户说"code review"，只修已知 bug 没产出 P0/P1/P2 全面审查
✅ 完整门控链：IR → SR → AR → 正向串讲 → 反向串讲 → 测试用例设计 → 编码 → Code Review → P0/P1 归零 → 更新进度。方案越完整隐含假设越多，越需要逐项提交用户确认。落盘流程逐步执行不跳步。CR = 读改动文件 → 产出 P0/P1/P2 → 修复 → 重复直到归零
> 九次复犯（DEV-4/9/17/25/26/28 + M6.1 + M6-错题本落盘 + M6-CR）。

### DEV-5 实施不遵循 TDD 文档 `🟢`

❌ TDD 定义了接口格式，实施时自己改了字段名
✅ 严格按 TDD 实施，需要改设计先更新 TDD 再改代码
> TDD 是契约，改契约需要走流程。

### DEV-6 改代码不 grep 引用 + 不复用 pattern + 不对照 TDD `🟡中频×2`

❌ 改了签名/返回值不 grep 全量引用 → 下游断裂；不 grep 同类实现从零写 → Code Review 出 P1；写完不对照 TDD → 字段名偏离
✅ 改前 grep 同类 pattern 复用 → 改前 grep 全量引用确认 → 改后逐条对照 TDD → 改后涟漪推演（变量可达性+mock 同步）
> 详见 [postmortem-dev-bug-6.md](../postmortems/postmortem-dev-bug-6.md)、[postmortem-dev-bug-11.md](../postmortems/postmortem-dev-bug-11.md)

### DEV-7 测试验证偷懒：pytest 冒充 ST / E2E 不跑 / 旧服务器没重启 `🟡中频×2`

❌ pytest 全绿就声称"ST 通过"；E2E 脚本写了不当场跑就 commit；代码改了但旧服务器还在跑，测试结果不可信
✅ ST = 真实服务器+真实网络，不是 pytest；E2E 写完必须当场跑看到真实响应；改了 server/*.py → kill 旧进程+重启
> 详见 [postmortem-dev-bug-12.md](../postmortems/postmortem-dev-bug-12.md)

### DEV-24 更新文档只改局部不扫全文 `🟢`

❌ 用户说"更新 README"，只改了截图和架构图，没扫描全文 → 特性列表、计划中、测试数字、项目结构、文档链接全部过时
✅ 更新任何文档前先全文扫描，列出所有过时点，一次性全部更新。"更新"= 全面审查一致性，不是只改最明显的一处

### DEV-29 P0/P1 修复列表漏项 + 执行节奏碎片化 `🟢`

❌ Code Review 列了 5 个 P1，只修了 4 个漏掉 P1-5；独立修改逐个做每个停一次；ST 脚本碎片追加 Edit 7-8 次卡在匹配不唯一；独立文件更新串行 6 次来回
✅ P0/P1 列表逐条核销不漏项；多个独立修改一条消息并行发出；新建长文件 Write 主体+最多 1-2 次 Edit 补尾；独立文件更新并行

### DEV-32 门控表缺视觉序号 → TDD 被误当里程碑起始动作 `🟢`

❌ 用户说"启动 M6 规划"，AI 看到门控表里 AR 列写着 `TDD-M*-xxx.md`，条件反射"先写 TDD"，跳过了 IR 和 SR
✅ 门控表已修复：三行加 ①②③ 序号，AR 行 TDD 旁加括号备注"IR+SR 通过后才写"

### DEV-33 pytest 冒充 ST（DEV-7 复犯）+ P0/P1 归零跳过归因 `🟡中频×2`

❌ 任务入口判断"直接实施"→ 跳过 ST checklist → 复用 pytest 模式写 test_m5_e2e.py → 声称"ST 通过"；修完 P1-1 直接宣布"P0/P1 归零"，没有归因
✅ ST 脚本必须放 server/e2e_*.py + 真实服务器；P0/P1 归零 = 修复 + 归因（路径 A/B/C/D）+ 判断是否更新 checklist，三步缺一不可

### DEV-34 SR 阶段门禁当建议跳过 → 实现与验证脱节 `🟢`

❌ SR 写了"T4 通过后进入阶段 B"，但 pytest 全绿就直接编码；ST 绕开 LLM 只测自动机
✅ SR 阶段门禁是硬性卡点；编码前回 SR 确认"当前阶段、前置 T 是否通过"；ST 对照 SR 验收标准逐条确认
